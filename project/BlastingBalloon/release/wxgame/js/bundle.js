!function(){"use strict";var WXDataManager;!function(WXDataManager){function authorizedWXLogin(){Laya.Browser.onMiniGame&&WXDataManager.wx.login({success:function(res){res.code&&console.log("登录成功，获取到code",res.code);var button=WXDataManager.wx.createUserInfoButton({type:"text",text:"开始游戏",style:{left:WXDataManager.wx.getSystemInfoSync().screenWidth/2-60,bottom:WXDataManager.wx.getSystemInfoSync().screenHeight/2-60,width:120,height:40,lineHeight:40,backgroundColor:"#fb94a9",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:20}});button.show(),button.onTap(res=>{console.log(res),"getUserInfo:ok"===res.errMsg?(console.log("已经授权"),button.destroy(),getUserinfo(null)):console.log("没有授权")})}})}function getUserinfo(type){Laya.Browser.onMiniGame&&(WXDataManager.wx.cloud.init({env:"release-lwg"}),WXDataManager.wx.cloud.callFunction({name:"login"}).then(res=>{if(console.log("登录成功回调：",res),WXDataManager.WXopenid=res.result.openid,console.log("WXopenid为：",WXDataManager.WXopenid),WXDataManager.user_id=WXDataManager.WXopenid,"loginAgain"===type)try{add_Levels()}catch(error){console.log(error)}else if("haveLogin"===type)try{get_Levels()}catch(error){console.log(error)}}))}function add_Levels(){if(Laya.Browser.onMiniGame){WXDataManager.wx.cloud.init({env:"release-lwg"});let db=WXDataManager.wx.cloud.database();db.collection("user_info").add({data:{_id:WXDataManager.user_id,_levels:WXDataManager._thislevels,due:new Date("2018-09-01"),location:new db.Geo.Point(113,23),done:!1}}).then(res=>{console.log("没有登录过重新上传："+res)})}}function get_Levels(){if(Laya.Browser.onMiniGame){WXDataManager.wx.cloud.init({env:"release-lwg"}),WXDataManager.wx.cloud.database().collection("user_info").doc(WXDataManager.user_id).get().then(res=>{console.log(res.data),WXDataManager._lastlevels=res.data._levels,console.log("上次的关卡数为："+WXDataManager._lastlevels),WXDataManager._thislevels=WXDataManager._lastlevels})}}WXDataManager._thislevels=0,WXDataManager.wx=Laya.Browser.window.wx,WXDataManager.WXcheckSession=function(){Laya.Browser.onMiniGame&&WXDataManager.wx.checkSession({success(){console.log("已经登录过了！")},fail(){authorizedWXLogin(),console.log("重新登录")}})},WXDataManager.authorizedWXLogin=authorizedWXLogin,WXDataManager.normalWXLogin=function(){Laya.Browser.onMiniGame&&WXDataManager.wx.checkSession({success(){console.log("已经登录过了！"),getUserinfo("haveLogin")},fail(){console.log("重新登录"),WXDataManager.wx.login({success(res){getUserinfo("loginAgain")},fail(){console.log("登录失败")}})}})},WXDataManager.getUserinfo=getUserinfo,WXDataManager.add_Levels=add_Levels,WXDataManager.get_Levels=get_Levels,WXDataManager.update_Levels=function(){Laya.Browser.onMiniGame&&(WXDataManager.wx.cloud.init({env:"release-lwg"}),WXDataManager.wx.cloud.database().collection("user_info").doc(WXDataManager.user_id).update({data:{_levels:WXDataManager._thislevels}}).then(res=>{console.log(res)}))}}(WXDataManager||(WXDataManager={}));class GameControl extends Laya.Script{constructor(){super(),this.intType=1e3,this.numType=1e3,this.strType="hello laya",this.boolType=!0}onEnable(){WXDataManager.normalWXLogin()}onDisable(){}}class GameConfig{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("Script/Project/GameControl.ts",GameControl)}}GameConfig.width=750,GameConfig.height=1334,GameConfig.scaleMode="fixedwidth",GameConfig.screenMode="none",GameConfig.alignV="top",GameConfig.alignH="left",GameConfig.startScene="Scenes/MainScene.scene",GameConfig.sceneRoot="",GameConfig.debug=!1,GameConfig.stat=!0,GameConfig.physicsDebug=!1,GameConfig.exportSceneToJson=!0,GameConfig.init();new class{constructor(){window.Laya3D?Laya3D.init(GameConfig.width,GameConfig.height):Laya.init(GameConfig.width,GameConfig.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=GameConfig.scaleMode,Laya.stage.screenMode=GameConfig.screenMode,Laya.stage.alignV=GameConfig.alignV,Laya.stage.alignH=GameConfig.alignH,Laya.URL.exportSceneToJson=GameConfig.exportSceneToJson,(GameConfig.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),GameConfig.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),GameConfig.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){GameConfig.startScene&&Laya.Scene.open(GameConfig.startScene)}}}();